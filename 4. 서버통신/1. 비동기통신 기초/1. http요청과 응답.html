<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <button id="load">서버에서 회원정보 불러오기</button>

    <ul class="content"></ul>

    <script>

        //서버가 응답한 정보를 화면에 렌더링
        function makeResultDOM(response) {
            /*
                서버가 응답한 데이터는 마치 자바스크립트의
                객체, 배열 형태로 보이지만 사실은 아닙니다.
                이런 형태의 데이터를 JSON이라고 부릅니다.

                JSON은 자바스크립트가 아닌 독립적 데이터 포맷이기
                때문에 사용하려면 자바스크립트로 변환해서 써야 합니다.

                # json -> js :  JSON.parse()
                  js -> json :  JSON.stringify()
            */

            //JSON을 자바스크립트로 변환
            const userList = JSON.parse(response);
            console.log(userList[0].userName);

            const $ul = document.querySelector('.content');
            for (let user of userList) {
                const {account, userName, address} = user;
                const $li = document.createElement('li');
                $li.textContent = `# 아이디: ${account}, 이름: ${userName}, 주소: ${address}`;

                $ul.appendChild($li);
            }
        }


        const $loadBtn = document.getElementById('load');

        $loadBtn.onclick = e => {

            // # http 요청을 서버로 보내는 방법
            //1. XMLHttpRequest 객체를 생성
            const xhr = new XMLHttpRequest();

            //2. http 요청 설정 (요청방식, 요청URL)
            /*
                - 요청 방식:
                a. GET - 조회
                b. POST - 등록
                c. PUT - 수정
                d. DELETE - 삭제
            */
            xhr.open('GET', 'http://localhost:5000/user');

            //3. http 요청 전송
            xhr.send();

            //4. 응답정보 확인
            xhr.onload = e => {
                //응답코드
                console.log(xhr.status); 
                //응답 데이터 확인
                //console.log(xhr.response);

                if (xhr.status === 200) {
                    makeResultDOM(xhr.response);
                } else {
                    console.error('통신 실패!');
                }
            };
        };

    </script>

</body>
</html>